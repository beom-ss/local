/*연습문제4.3*/

data computer;
infile "D:\computer_repair.txt"  expandtabs firstobs=2 ;
input Units 	Minutes;
run;

proc reg data = computer;
model minutes = units;
quit;

/*(a) minutes=units 로하는 회귀 모형 적합* /

proc insight data = computer;
run;

proc reg data=computer ;
	model minutes = units / r influence vif ;
	ods output Outputstatistics = temp_all;  /* 모든 통계량을 출력 */
quit;

proc reg data=computer;
	model minutes = units  /influence ;
	output out=ComRe1
		p=yhat	Residual=ei Student=ri Cookd=cooki Rstudent=ti h=hii COVRATIO=cov DFFITS=df_fit PRESS=press ;
quit;

proc kde data=ComRe1 out=density;
  var ti;
run;
proc sort data=density;
  by ti;
run;
proc gplot data=density;
  plot density*ti = 1;
run; 
quit;
/*(b) 아래 하나하나씩 위반하는거 서술 정규성가정,선형성가정,등분산성,독립성을 서술*/
/*   H0 : 정규성이다 H1: 정규성이 아니다.
density 와 residual의 그래프를 보면 0을 기준으로 정규분포를 따른다.*/
/*정규성가정은 위배되지 않는다*/

/*관측치 번호 할당*/
data comRe2 ;                 
	SET ComRe1 ;
    	id = _N_ ;  
RUN; 
                                            
proc insight data=ComRe3; 
run; 

/*표준화잔차와 x와의 관계를 산점도로 보게 되면 위로 볼록한 
이차원 곡선이 나타난다. 이는 선형성가정에 위배된다.*/
/*student residual를 차례로 나열 할 때   ri=0을 중심에 두고 랜덤하게
분포해야 되지만 곡선적 관계가 보여, 독립성에 위배된다*/





/*연습문제 4.12*/

data p;
infile "D:\p121.txt"  expandtabs firstobs=2 ;
input y x1 x2 x3 x4 x5 x6;
run;

proc reg data = p;
model y =x1 x2 x3 x4 x5 x6 ;
quit;

proc insight data=p; 
run; 

proc reg data=p;
	model y = x1-x6 / vif; /* 설명변수들 사이의 다중공선성(multicollinearity) 탐지 */
quit;
/*VIF > 10일 때, 다중공선성이 존재한다고 판단함으로 여기서는 variance inflation값이
 x1,x2, x3, x6 >10이므로 다중공선성의 문제가 있는 것으로 판단된다.*/







proc reg data=ex12;
	model y = x1 x2 x3 x4 x5 x6 /influence ;
	output out=ex122
		p=yhat	Residual=ei Student=ri Cookd=cooki Rstudent=ti h=hii COVRATIO=cov DFFITS=df_fit PRESS=press ;
quit;


data ex123 ;                 
	SET ex122 ;
    	id = _N_ ;  
RUN; 
proc insight data=ex123; 
run; 
proc plot data=ex122 ;   
	plot  hii * id /vpos=30 hpos=120 ;                    /*지레값(leverage value)의 인덱스 플롯*/
  	plot  cooki * id /vpos=30 hpos=120 ;               /*Cook's Distance 인덱스 플롯*/
	plot  df_fit * id /vpos=30 hpos=120 ;                /*DFITS값의 인덱스 플롯*/
run;
data ex123;
	set ex122 ;
	di = (ei/sqrt(26813)) ;
    potential_Fuction = hii/(1-hii) ;
	residual_Function = ((1+1)/(1-hii))*((di*di)/(1-di*di)) ;
	hadi = potential_Fuction + residual_Function ;
run;
proc plot data= ex123 ;   
	plot  hadi * id /vpos=30 hpos=120 ;                                                 /*hadi의 영향력 측도의 인덱스 플롯*/
  	plot  potential_Fuction * residual_Function /vpos=30 hpos=120 ;
/*(b) 위 ex12_2 데이타 셋에 계산된 값이 있다.*/
/*(c) 각각의 인덱스 플롯과 잠재성 잔차플롯을 구할수있는 프로세스 .*/


proc insight data=ex123;
run;
/*(d)  그래프에서의 비정상적인 관측개체를 확인해보면 38번 관측치(outlier), 12번 관측치(outlier & high laverage& influential point), 
34번 관측치(outlier&high laverage&influential point), 17번 관측치(outlier) 정도가 비정상적으로 관측된다.*/ 






